# 产品需求文档 (PRD) - 核心功能: 证书资产管理

*   **文档版本:** V0.1.1 (优化版)
*   **模块 ID:** CERT-MGMT
*   **模块优先级:** 高 (P0)
*   **用户角色:** 管理员 (Administrator)

## 1. 引言

### 1.1 项目背景
随着企业IT资产的增加，域名证书的数量和管理复杂度日益增长。手动追踪证书的到期时间、负责人等信息容易出错且效率低下，可能导致因证书过期引发的服务中断。本项目旨在开发一个证书资产管理系统，帮助管理员集中管理域名证书，自动化追踪其生命周期，并及时预警。

### 1.2 项目目标
*   实现域名证书信息的集中录入、查询、修改和删除。
*   自动计算并展示证书的当前状态（如：正常、即将过期、已过期）。
*   提供清晰的证书列表和详情视图，方便管理员快速概览和定位。
*   为未来扩展（如自动续期提醒、证书文件管理等）奠定基础。

## 2. 功能需求

### 2.1 功能点 1: 录入新证书 (CERT-MGMT-001)

*   **需求描述:** 管理员能够手动添加新的域名证书信息到系统中。
*   **优先级:** 高 (P0)
*   **用户故事:** 作为管理员，我希望能手动录入一个新的域名证书信息，包括其关联域名、颁发机构、到期时间和负责人等，以便系统能够追踪其生命周期。
*   **业务流程/功能规格:**
    1.  管理员在系统中访问“证书管理”功能模块。
    2.  点击“新增证书”按钮。
    3.  系统展示“新增证书”表单，包含以下字段：
        *   **关联域名 (domainName):** 文本输入，必填。需进行基本域名格式校验 (例如，符合RFC1035标准，但不做DNS真实性校验)。
        *   **备用名称 (sans):** 文本区域 (textarea) 输入，可选。多个SAN通过英文逗号 (`,`) 或换行分隔。
        *   **证书颁发机构 (issuer):** 文本输入，必填，非空。
        *   **证书到期时间 (expirationDate):** 日期时间选择器，必填。选择的日期时间必须晚于当前时间。格式 `yyyy-MM-dd HH:mm:ss`。
        *   **证书负责人 (owner):** 文本输入，必填，非空。
        *   **备注 (notes):** 文本区域 (textarea) 输入，可选。
    4.  管理员填写完毕后，点击“保存”按钮。
    5.  系统进行前端数据校验（如必填项、格式）。
    6.  若前端校验通过，数据提交至后端。
    7.  后端进行业务校验（如域名是否已存在，日期有效性等）。
    8.  若后端校验通过：
        *   系统持久化证书数据到数据库。
        *   系统根据当前时间和到期时间，自动计算并设置证书的初始状态 (参考`架构设计文档.md`中的状态计算逻辑)。
        *   系统记录创建时间和更新时间。
        *   系统返回成功提示信息，并刷新证书列表页或跳转至列表页。
    9.  若任一校验失败，系统在表单相应位置或页面顶部展示明确的错误提示信息，保留用户已填数据。

### 2.2 功能点 2: 查看证书列表 (CERT-MGMT-002)

*   **需求描述:** 管理员能够以列表形式查看系统中所有已录入的证书，并进行排序和分页。
*   **优先级:** 高 (P0)
*   **用户故事:** 作为管理员，我希望进入系统后能看到一个清晰的证书列表，包含关键信息如域名、到期时间、状态等，方便我快速概览和定位证书。
*   **业务流程/功能规格:**
    1.  管理员访问“证书管理”功能模块的默认页面（即证书列表页）。
    2.  系统以表格形式展示证书列表。
    3.  列表默认展示列：
        *   `关联域名 (domainName)`
        *   `证书颁发机构 (issuer)`
        *   `证书到期时间 (expirationDate)` (格式 `yyyy-MM-dd HH:mm:ss`)
        *   `状态 (status)` (如：正常, 即将过期, 已过期)
        *   `证书负责人 (owner)`
        *   `操作` (包含“详情”、“编辑”、“删除”按钮/链接)
    4.  支持按“证书到期时间”进行升序（默认）或降序排序。
    5.  当证书数量超过预设阈值 (例如，每页10条) 时，启用分页控件，允许用户跳转页面、选择每页显示数量。
    6.  列表上方或下方显示当前证书总数、总页数等分页信息。

### 2.3 功能点 3: 查看证书详情 (CERT-MGMT-003)

*   **需求描述:** 管理员能够查看单个证书的所有已录入信息。
*   **优先级:** 高 (P0)
*   **用户故事:** 作为管理员，当我想了解某个证书的完整信息时，我希望能方便地查看它的详情。
*   **业务流程/功能规格:**
    1.  管理员在证书列表页中，点击目标证书对应的“详情”操作按钮/链接。
    2.  系统弹出模态框或跳转至证书详情页面。
    3.  页面以只读形式展示该证书的所有字段信息，包括：
        *   `ID`
        *   `关联域名 (domainName)`
        *   `备用名称 (sans)`
        *   `证书颁发机构 (issuer)`
        *   `证书到期时间 (expirationDate)`
        *   `证书负责人 (owner)`
        *   `备注 (notes)`
        *   `状态 (status)`
        *   `创建时间 (createdAt)`
        *   `最后更新时间 (updatedAt)`
    4.  提供“返回”或“关闭”操作按钮，以关闭详情视图并返回列表页。

### 2.4 功能点 4: 编辑证书信息 (CERT-MGMT-004)

*   **需求描述:** 管理员能够修改已存在的证书信息。
*   **优先级:** 高 (P0)
*   **用户故事:** 作为管理员，如果证书的负责人变更了，或者录入时有信息错误，我希望能修改这些信息。
*   **业务流程/功能规格:**
    1.  管理员在证书列表页中，点击目标证书对应的“编辑”操作按钮/链接。
    2.  系统弹出模态框或跳转至“编辑证书”表单页面，表单中预先填充该证书的当前信息。
    3.  表单字段及校验规则同“录入新证书”(CERT-MGMT-001)，但关联域名通常不允许修改或需特殊处理（此处假设允许修改，但若修改，需校验新域名是否冲突）。
    4.  管理员修改完毕后，点击“保存”或“更新”按钮。
    5.  系统进行前后端校验。
    6.  若校验通过：
        *   系统更新数据库中对应的证书记录。
        *   系统根据修改后的信息（特别是到期时间）重新计算并更新证书状态。
        *   系统更新“最后更新时间”。
        *   系统返回成功提示信息，并刷新证书列表页或跳转至列表页。
    7.  若校验失败，处理方式同“录入新证书”。

### 2.5 功能点 5: 删除证书记录 (CERT-MGMT-005)

*   **需求描述:** 管理员能够从系统中删除不再需要管理的证书记录。
*   **优先级:** 高 (P0)
*   **用户故事:** 作为管理员，对于已经下线或不再使用的服务的证书，我希望能将其从管理列表中移除。
*   **业务流程/功能规格:**
    1.  管理员在证书列表页中，点击目标证书对应的“删除”操作按钮/链接。
    2.  系统弹出确认对话框，提示信息如：“确定要删除域名 ‘[域名]’ 的证书记录吗？此操作不可恢复。”
    3.  若管理员点击“确认”：
        *   系统从数据库中删除该证书记录。
        *   系统返回成功提示信息。
        *   系统刷新证书列表页。
    4.  若管理员点击“取消”，则关闭确认对话框，不执行任何操作。

## 3. 数据模型/字典

*   **证书表 (certificates):**
    *   `id`: BIGINT, 主键 (PK), 自增 (Auto Increment)
    *   `domain_name`: VARCHAR(255), Not Null, Unique Index (证书关联的域名)
    *   `sans`: TEXT, Nullable (证书的备用名称，多个以逗号分隔)
    *   `issuer`: VARCHAR(255), Not Null (证书颁发机构)
    *   `expiration_date`: DATETIME, Not Null, Index (证书到期时间)
    *   `owner`: VARCHAR(255), Not Null (证书负责人)
    *   `notes`: TEXT, Nullable (备注信息)
    *   `status`: VARCHAR(20), Not Null, Default 'NORMAL', Index (证书状态: NORMAL, EXPIRING_SOON, EXPIRED)
    *   `created_at`: DATETIME, Not Null (记录创建时间)
    *   `updated_at`: DATETIME, Not Null (记录最后更新时间)

## 4. 非功能性需求

*   **易用性:** 用户界面应简洁直观，操作流程清晰，错误提示友好明确。
*   **性能:**
    *   证书列表页面加载时间（1000条数据以内）应少于2秒。
    *   CRUD操作响应时间应少于1秒。
*   **安全性:** (本次主要关注后端API安全)
    *   对所有用户输入进行有效性校验和适当过滤，防止XSS、SQL注入等常见Web攻击。
    *   API接口应考虑基本的防暴力破解机制（如速率限制，本次可不实现）。
*   **可维护性:**
    *   后端代码结构遵循领域驱动设计（DDD）原则，分层清晰。
    *   代码注释充分，关键逻辑有说明。
    *   遵循统一的编码规范。
*   **API文档化:** 所有对外API必须提供符合OpenAPI规范的Swagger文档，方便前端或其他服务调用。
*   **可靠性:** 系统应能稳定运行，数据持久化可靠。定时任务能按时准确执行。

## 5. 待定项/未来考虑

*   证书文件的上传、存储与下载功能。
*   证书颁发机构使用预定义的下拉选择列表，而非手动输入。
*   证书负责人与系统内部用户账户关联。
*   更细致的证书状态自动更新与通知机制（如邮件通知）。
*   批量导入/导出证书数据。
*   证书自动续签的提醒或半自动化流程。
*   操作审计日志。